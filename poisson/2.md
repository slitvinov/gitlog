---
jupytext:
  formats: ipynb,md:myst
  text_representation:
    extension: .md
    format_name: myst
    format_version: 0.13
    jupytext_version: 1.16.4
kernelspec:
  display_name: Python 3
  name: python3
---

[![Open in
Colab](https://colab.research.google.com/assets/colab-badge.svg)](https://colab.research.google.com/github/slitvinov/gitlog/blob/main/poisson/2.ipynb)

```{code-cell}
import matplotlib.pyplot as plt
import scipy
import numpy as np
import functools
@functools.cache
def boundary(i, j):
    boundary0 = i == m - 1 or j == 0 or j == m - 1 or i <= j
    boundary1 = (8 * i - 6 * m)**2 + (8 * j - 2 * m)**2 < m**2
    return 0 if boundary0 else 1 if boundary1 else None
def add(i, j, c):
    val = boundary(i, j)
    if val is None:
        if (i, j) not in ik:
            ik[i, j] = len(ik)
        data.append(c)
        col.append(ik[i, j])
        row.append(len(rhs) - 1)
    else:
        rhs[-1] -= c * val
plt.rcParams["image.cmap"] = "jet"
m = 40
ik = {}; data = []; col = []; row = []; rhs = []
for i in range(m):
    for j in range(m):
        if boundary(i, j) is None:
            rhs.append(0)
            add(i, j, -4) # 5 point scheme for the Poisson equation
            add(i - 1, j, 1)
            add(i + 1, j, 1)
            add(i, j - 1, 1)
            add(i, j + 1, 1)
A = scipy.sparse.csr_matrix((data, (row, col)), dtype=float)
sol = scipy.sparse.linalg.spsolve(A, rhs)
fi = np.empty((m, m))
fi.fill(None)
for s, t in zip(sol, ik):
    fi[t] = s
plt.imshow(fi)
plt.axis("off");
```
